# AINEON Enterprise Trading Platform - Testing Configuration
# Chief Architect Mission - Comprehensive Test Framework

[tool:pytest]
# Test Discovery
testpaths = tests
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*

# Minimum Python version
minversion = 6.0

# Add Options
addopts = 
    --strict-markers
    --strict-config
    --verbose
    --tb=short
    --durations=10
    --cov=core
    --cov-report=term-missing
    --cov-report=html:htmlcov
    --cov-report=xml:coverage.xml
    --cov-fail-under=80
    --cov-branch
    --junitxml=test-results.xml
    --asyncio-mode=auto

# Test Markers
markers =
    unit: Unit tests - Fast, isolated tests
    integration: Integration tests - Tests component interactions
    functional: Functional tests - End-to-end feature tests
    performance: Performance tests - Speed and resource usage tests
    security: Security tests - Authentication and authorization tests
    blockchain: Blockchain integration tests
    ai: AI/ML model tests
    smoke: Smoke tests - Basic functionality verification
    regression: Regression tests - Ensure previous bugs don't return
    chaos: Chaos engineering tests - Resilience under failure
    slow: Slow tests - May take more than 10 seconds
    medium: Medium speed tests - 1-10 seconds
    fast: Fast tests - Under 1 second
    live: Live trading tests (use with extreme caution)
    simulation: Simulation environment tests
    production: Production environment tests (restricted access)

# Filter Warnings
filterwarnings =
    error
    ignore::UserWarning
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::pytest.PytestUnraisableExceptionWarning
    # Ignore specific warnings from dependencies
    ignore::cryptography.utils.CryptographyDeprecationWarning
    ignore::web3.utils.exceptions.Web3DeprecationWarning

# Asyncio Configuration
asyncio_mode = auto

# Timeout Configuration (requires pytest-timeout)
timeout = 300
timeout_method = thread

# Logging Configuration
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s: %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

log_file = tests/logs/pytest.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] %(filename)s:%(lineno)d %(name)s: %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S

# Test Collection Configuration
collect_ignore = [
    "setup.py",
    "docs/",
    "build/",
    "dist/",
    "venv/",
    ".venv/",
    "__pycache__/",
    ".pytest_cache/",
    "node_modules/"
]

# Coverage Configuration
[coverage:run]
source = core
omit = 
    */tests/*
    */test_*
    */__pycache__/*
    */venv/*
    */.venv/*
    */migrations/*
    */alembic/*
    */__init__.py
    */settings.py
    */config.py
    */constants.py
    */exceptions.py

branch = true
parallel = true
concurrency = thread
concurrency_count = 4

[coverage:report]
exclude_lines =
    pragma: no cover
    def __repr__
    if self.debug:
    if settings.DEBUG
    raise AssertionError
    raise NotImplementedError
    if 0:
    if __name__ == .__main__.:
    class .*\bProtocol\):
    @(abc\.)?abstractmethod

show_missing = true
precision = 2

[coverage:html]
directory = htmlcov
title = AINEON Enterprise Trading Platform Coverage Report

[coverage:xml]
output = coverage.xml

# Performance Testing Configuration
benchmark_only = false
benchmark_warmup = true
benchmark_warmup_iterations = 5
benchmark_min_rounds = 5
benchmark_max_time = 10.0
benchmark_min_time = 0.000005
benchmark_timer = time.perf_counter

# Parallel Testing Configuration
# Requires pytest-xdist
# Uncomment to enable parallel testing
# -n auto

# Flaky Tests Configuration
# Requires pytest-flaky
# Uncomment to handle flaky tests
# flaky_strict = true
# flaky_max_runs = 3
# flaky_min_runs = 1

# Timeout Configuration
# Requires pytest-timeout
# Global timeout for all tests
timeout = 600
timeout_method = thread

# Random Test Order
# Requires pytest-randomly
randomly_seed = 42
randomly_dont_reset_seed = true

# Auto-wrapping Tests
# Requires pytest-httpx
# Automatically wraps HTTP tests
# httpx_use_mock = true

# Parallel Test Execution
# Requires pytest-xdist
# Distribute tests across multiple CPU cores
# -n 4

# Memory Testing
# Requires pytest-memray
# Track memory usage during tests
# memray_bin_path = ./memray

# Code Quality Checks
# Requires pytest-codspeed
# Measure performance regressions
# codspeed

# Django Testing Configuration (if using Django)
# Requires pytest-django
# django_settings_module = tests.settings
# django_find_project = false

# Custom Test Configuration for AINEON
# Trading-specific test configurations
[trading_tests]
# Risk management testing
max_drawdown_test = 0.02  # 2% maximum drawdown tolerance
min_profit_margin = 0.01  # 1% minimum profit margin
max_position_size = 1.0   # Maximum position size in ETH

# Performance testing thresholds
max_trade_execution_time = 0.1  # 100ms maximum execution time
max_api_response_time = 0.05    # 50ms maximum API response time
min_throughput = 100            # Minimum trades per minute

# Blockchain testing
min_gas_price = 10              # Minimum gas price in gwei
max_gas_price = 200             # Maximum gas price in gwei
testnet_rpc_url = https://sepolia.infura.io/v3/test

# AI/ML testing
model_accuracy_threshold = 0.85 # Minimum model accuracy
prediction_confidence_threshold = 0.8 # Minimum prediction confidence

# Security testing
max_authentication_time = 5.0   # Maximum authentication time in seconds
session_timeout = 3600          # Session timeout in seconds
max_failed_attempts = 3         # Maximum failed login attempts

# Dashboard testing
dashboard_load_time = 2.0       # Maximum dashboard load time in seconds
chart_render_time = 1.0         # Maximum chart render time in seconds

# Integration testing
database_connection_timeout = 30 # Database connection timeout
redis_connection_timeout = 10   # Redis connection timeout
external_api_timeout = 30       # External API timeout

# Live Trading Tests (Highly Restricted)
# Only run with explicit approval and in isolated environments
[live_trading_tests]
enabled = false
require_approval = true
isolation_required = true
max_test_amount = 0.01  # Maximum 0.01 ETH for testing
emergency_stop_enabled = true

# Chaos Engineering Tests
[chaos_tests]
enabled = true
failure_rate = 0.1  # 10% of tests should simulate failures
network_partition_probability = 0.05
database_failure_probability = 0.02
api_failure_probability = 0.03

# Load Testing Configuration
[load_tests]
concurrent_users = 10
test_duration = 300  # 5 minutes
ramp_up_time = 60    # 1 minute ramp up
think_time = 2       # 2 seconds between actions

# Security Test Configuration
[security_tests]
require_mtls = true
max_session_time = 1800  # 30 minutes
rate_limit_enabled = true
cors_enabled = false     # CORS should be disabled for API

# Test Data Configuration
[test_data]
use_mock_data = true
preserve_test_data = false
cleanup_after_test = true
seed_random = true

# Environment Configuration
[test_environment]
test_mode = true
debug_logging = true
feature_flags = {
    "ai_optimization": true,
    "flash_loans": true,
    "cross_chain": false,
    "gas_optimization": true,
    "risk_management": true,
    "real_time_monitoring": true
}

# Database Configuration for Tests
[test_database]
url = sqlite:///test.db
isolation_level = AUTOCOMMIT
pool_pre_ping = true
pool_recycle = 3600

# Redis Configuration for Tests
[test_redis]
url = redis://localhost:6379/15  # Use database 15 for tests
socket_timeout = 5
socket_connect_timeout = 5
max_connections = 10

# Monitoring Configuration
[test_monitoring]
enable_metrics = true
enable_tracing = true
enable_profiling = false
metrics_port = 9091

# Test Reporting
[test_reporting]
generate_html_report = true
generate_junit_report = true
generate_json_report = true
include_coverage = true
include_performance_metrics = true
include_security_report = false  # Security reports are handled separately