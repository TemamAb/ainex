# AINEON Flash Loan Engine - Production Deployment Configuration
# Auto-deploy from GitHub: github.com/TemamAb/myneon

services:
  # ============================================================================
  # Main AINEON Engine API (Production)
  # ============================================================================
  - type: web
    name: aineon-engine-api
    env: python
    plan: starter
    buildCommand: |
      pip install --upgrade pip
      pip install -r backend/requirements.txt
      pip install -r core/requirements.txt
      pip install streamlit plotly pandas numpy web3 eth-brownie
    startCommand: |
      cd backend && python -m uvicorn app.main:app --host 0.0.0.0 --port $PORT --workers 2
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.0
      - key: ENVIRONMENT
        value: PRODUCTION
      - key: ETH_RPC_URL
        value: https://mainnet.infura.io/v3/YOUR_INFURA_KEY
      - key: WALLET_ADDRESS
        value: 0xYourWalletAddress
      - key: PRIVATE_KEY
        value: your_private_key_here
      - key: ETHERSCAN_API_KEY
        value: your_etherscan_api_key
      - key: DEBUG
        value: false
      - key: PROFIT_MODE
        value: ENTERPRISE_TIER
      - key: AUTO_TRANSFER_ENABLED
        value: "true"
      - key: PROFIT_THRESHOLD_ETH
        value: "1.0"
      - key: MIN_PROFIT_PER_TRADE
        value: "0.1"
      - key: MAX_POSITION_SIZE
        value: "1000.0"
      - key: DAILY_LOSS_LIMIT
        value: "100.0"
      - key: ENABLE_PROFIT_AUDIT
        value: "true"
      - key: ENABLE_ETHERSCAN_VERIFICATION
        value: "true"
    healthCheckPath: /api/status
    healthCheckPath: /api/health
    autoDeploy: true

  # ============================================================================
  # Real-Time Dashboard (Streamlit)
  # ============================================================================
  - type: web
    name: aineon-dashboard
    env: python
    plan: starter
    buildCommand: |
      pip install --upgrade pip
      pip install streamlit plotly pandas numpy requests python-dateutil
      pip install -r aineon-dashboard/requirements.txt
    startCommand: |
      cd aineon-dashboard && streamlit run user_friendly_dashboard.py --server.port=$PORT --server.address=0.0.0.0 --server.headless=true --server.runOnSave=true
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.0
      - key: API_BASE_URL
        fromService:
          type: web
          name: aineon-engine-api
          property: host
      - key: STREAMLIT_SERVER_PORT
        value: $PORT
      - key: STREAMLIT_SERVER_ADDRESS
        value: 0.0.0.0
    healthCheckPath: /
    autoDeploy: true

  # ============================================================================
  # Profit Monitoring Service
  # ============================================================================
  - type: worker
    name: aineon-monitor
    env: python
    plan: starter
    buildCommand: |
      pip install --upgrade pip
      pip install -r core/requirements.txt
      pip install requests schedule
    startCommand: |
      python flash_loan_monitor.py
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.0
      - key: API_BASE_URL
        fromService:
          type: web
          name: aineon-engine-api
          property: host
      - key: ENVIRONMENT
        value: PRODUCTION
    autoDeploy: true

  # ============================================================================
  # Background Profit Processing
  # ============================================================================
  - type: worker
    name: aineon-profit-processor
    env: python
    plan: starter
    buildCommand: |
      pip install --upgrade pip
      pip install -r core/requirements.txt
    startCommand: |
      python real_time_profit_monitor.py
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.0
      - key: API_BASE_URL
        fromService:
          type: web
          name: aineon-engine-api
          property: host
      - key: ENVIRONMENT
        value: PRODUCTION
    autoDeploy: true

# ============================================================================
# Database (Optional - for persistent data storage)
# ============================================================================
# - type: pserv
#   name: aineon-postgres
#   plan: starter
#   databaseName: aineon_db
#   user: aineon_user
#   autoDeploy: true

# ============================================================================
# Redis Cache (Optional - for high-performance caching)
# ============================================================================
# - type: redis
#   name: aineon-redis
#   plan: starter
#   maxmemoryPolicy: allkeys-lru
#   autoDeploy: true